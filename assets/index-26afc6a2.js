import{ac as e,U as l,v as a,z as t,ad as o,x as u,q as r,a2 as d,a3 as s,p as n,ae as i,l as f,W as v}from"./index-bd032176.js";import{v as c,a as m,B as p,d as b,c as y,f as w,h as _,F as g,I as h,M as k,i as V,N as D,J as K,u as F,G as P,_ as C,ap as q,aq as U,ag as j,Q as x,D as T,S as R}from"./vxetable-1644ac3d.js";import{u as I}from"./FitsTableProHook-dba3930a.js";import{F as S}from"./FitsCard-c6ad68c9.js";import"./echarts-c32f5a2f.js";const Y=e=>(q("data-v-c5204399"),e=e(),U(),e),H=Y((()=>V("i",{class:"vxe-icon-add"},null,-1))),B=Y((()=>V("span",{class:"redStar"},"*",-1))),M=Y((()=>V("i",{class:"vxe-icon-delete"},null,-1))),O={class:"dataBox"},N=f(c({__name:"DynamicTable",setup(f){const v=m(),c=m([]),q=m({}),U=m(),j=m(),x=m(),{fitsTablePro:T}=I({keepSource:!0,columns:[{field:"add",title:"操作",width:80,slots:{default:"addDefault"}},{field:"project",title:"项目",slots:{default:"projectDefault",header:"requiredHeader"}},{field:"batch",title:"批次/迭代",slots:{default:"batchDefault",header:"requiredHeader"}},{field:"type",title:"工时类型",slots:{default:"typeDefault"}},{field:"task",title:"任务内容",slots:{default:"taskDefault",header:"requiredHeader"}},{field:"responsible",title:"责任人",slots:{default:"responsibleDefault",header:"requiredHeader"}},{field:"reviewer",title:"工时审核人",slots:{default:"reviewerDefault"}},{field:"startdate",title:"计划开始",slots:{default:"startdateDefault"}},{field:"enddate",title:"计划完成",slots:{default:"enddateDefault"}},{field:"delete",title:"操作",width:80,slots:{default:"deleteDefault"}}],data:[{project:"",batch:"",type:"",task:"",responsible:"",reviewer:"",startdate:"",enddate:""},{project:"",batch:"",type:"",task:"",responsible:"",reviewer:"",startdate:"",enddate:""},{project:"",batch:"",type:"",task:"",responsible:"",reviewer:"",startdate:"",enddate:""}],align:"center",toolbarConfig:{slots:{buttons:"buttons"}},rowConfig:{keyField:"rowKey",useKey:!0},columnConfig:{useKey:!0}},x),R=m([{value:"丰德开发框架项目"},{value:"2019年领床路径系统二期产品"},{value:"2019年领床路径系统一期产品"},{value:"开发组"},{value:"2022年特种机电设备检测"},{value:"健康档案系统"},{value:"2021年资产管理系统"},{value:"2023Vue升级"}]),S=(e,l)=>{l(e?R.value.filter((l=>-1!==l.value.toLowerCase().indexOf(e))):R.value)},Y=m([{label:".net core开原框架研究",value:"0"},{label:"Fits Framework",value:"1"},{label:"PC后台管理网站",value:"2"},{label:"混合app-ionic5",value:"3"},{label:"辅助工具",value:"4"},{label:"新PC前端框架研发",value:"5"}]),N=m([{label:"项目管理",value:"0"},{label:"售前支持",value:"1"},{label:"需求分析",value:"2"},{label:"系统设计",value:"3"},{label:"功能开发",value:"4"}]),E=m([{label:"李小白",value:"0"},{label:"王辉",value:"1"},{label:"张冰冰",value:"2"},{label:"李萌萌",value:"3"},{label:"白静",value:"4"}]),G=p({project:[{required:!0,message:"请选择项目",trigger:"change"}],task:[{required:!0,message:"请输入任务内容",trigger:"change"}],batch:[{required:!0,message:"请选择批次",trigger:"change"}],responsible:[{required:!0,message:"请选择责任人",trigger:"change"}],startdate:[{validator:A,type:"date",trigger:"change"}],enddate:[{validator:A,type:"date",trigger:"change"}]});function $(){x.value.fitsTablePro.insertAt({project:"",batch:"",type:"",task:"",responsible:"",reviewer:"",startdate:"",enddate:""},-1),c.value=x.value.fitsTablePro.getTableData().tableData}function z(e,l){U.value=e.rowKey;const a="dateFormRef_"+e.rowKey+l.id;if(j.value=a,void 0===q.value[e.rowKey]?q.value[e.rowKey]={[l.field]:e[l.field]}:q.value[e.rowKey][l.field]=e[l.field],q.value[e.rowKey]&&void 0!==q.value[e.rowKey].startdate&&void 0!==q.value[e.rowKey].enddate){const t=a.split("_"),o="startdate"===l.field?Number(t.slice(-1))+1:Number(t.slice(-1))-1,u=`dateFormRef_${e.rowKey}col_${o}`;v.value.refs[u].validate()}}function A(l,a,t,o,u){if(q.value[U.value]&&a)if(q.value[U.value]&&q.value[U.value].startdate&&q.value[U.value].enddate)if(e(q.value[U.value].startdate).isBefore(q.value[U.value].enddate))t();else{const e="startdate"===l.field?"不得大于结束时间":"不得小于开始时间";t(new Error(e))}else t();else t()}function J(){c.value=x.value.fitsTablePro.getTableData().tableData}function L(){let e=0,l=0,t=0,o=0;for(let a in v.value.refs)-1!==a.indexOf("requiredFormRef_")&&null!==v.value.refs[a]&&l++,-1!==a.indexOf("dateFormRef_")&&null!==v.value.refs[a]&&o++;for(let u in v.value.refs)-1!==u.indexOf("requiredFormRef_")&&null!==v.value.refs[u]&&v.value.refs[u].validate(((l,a)=>{l&&e++})),-1!==u.indexOf("dateFormRef_")&&null!==v.value.refs[u]&&v.value.refs[u].validate(((u,r)=>{u&&(t++,e===l&&t===o&&a({message:"保存成功",type:"success"}))}))}return b((()=>{v.value=y()})),(e,a)=>{const f=t,v=o,m=u,p=r,b=d,y=s,q=n,U=i;return w(),_(P,null,[g(F(l),{option:F(T),ref_key:"xGrid",ref:x},{buttons:h((()=>[g(f,{onClick:J},{default:h((()=>[k(" 获取数据 ")])),_:1}),g(f,{onClick:L},{default:h((()=>[k(" 保存 ")])),_:1})])),addDefault:h((()=>[g(f,{onClick:$},{default:h((()=>[H])),_:1})])),requiredHeader:h((({slotProps:{column:e}})=>[B,V("span",null,D(e.title),1)])),projectDefault:h((({slotProps:{row:e,column:l}})=>[(w(),K(p,{ref:"requiredFormRef_"+e.rowKey+l.id,model:e,rules:F(G),key:e.rowKey},{default:h((()=>[g(m,{prop:"project"},{default:h((()=>[g(v,{modelValue:e.project,"onUpdate:modelValue":l=>e.project=l,placeholder:"请输入","fetch-suggestions":S,clearable:""},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1032,["model","rules"]))])),batchDefault:h((({slotProps:{row:e,column:l}})=>[(w(),K(p,{ref:"requiredFormRef_"+e.rowKey+l.id,model:e,rules:F(G),key:e.rowKey},{default:h((()=>[g(m,{prop:"batch"},{default:h((()=>[g(y,{modelValue:e.batch,"onUpdate:modelValue":l=>e.batch=l},{default:h((()=>[(w(!0),_(P,null,C(F(Y),(e=>(w(),K(b,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1032,["model","rules"]))])),typeDefault:h((({slotProps:{row:e}})=>[g(m,null,{default:h((()=>[g(y,{modelValue:e.type,"onUpdate:modelValue":l=>e.type=l},{default:h((()=>[(w(!0),_(P,null,C(F(N),(e=>(w(),K(b,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),taskDefault:h((({slotProps:{row:e,column:l}})=>[(w(),K(p,{ref:"requiredFormRef_"+e.rowKey+l.id,model:e,rules:F(G),key:e.rowKey},{default:h((()=>[g(m,{prop:"task"},{default:h((()=>[g(q,{modelValue:e.task,"onUpdate:modelValue":l=>e.task=l},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1032,["model","rules"]))])),responsibleDefault:h((({slotProps:{row:e,column:l}})=>[(w(),K(p,{ref:"requiredFormRef_"+e.rowKey+l.id,model:e,rules:F(G),key:e.rowKey},{default:h((()=>[g(m,{prop:"responsible"},{default:h((()=>[g(y,{modelValue:e.responsible,"onUpdate:modelValue":l=>e.responsible=l},{default:h((()=>[(w(!0),_(P,null,C(F(E),(e=>(w(),K(b,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1032,["model","rules"]))])),reviewerDefault:h((({slotProps:{row:e}})=>[g(m,null,{default:h((()=>[g(y,{modelValue:e.reviewer,"onUpdate:modelValue":l=>e.reviewer=l},{default:h((()=>[(w(!0),_(P,null,C(F(E),(e=>(w(),K(b,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),startdateDefault:h((({slotProps:{row:e,column:l}})=>[(w(),K(p,{ref:"dateFormRef_"+e.rowKey+l.id,model:e,rules:F(G),key:e.rowKey},{default:h((()=>[g(m,{prop:"startdate"},{default:h((()=>[g(U,{modelValue:e.startdate,"onUpdate:modelValue":l=>e.startdate=l,"value-format":"YYYY-MM-DD",onChange:a=>z(e,l)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:2},1024)])),_:2},1032,["model","rules"]))])),enddateDefault:h((({slotProps:{row:e,column:l}})=>[(w(),K(p,{ref:"dateFormRef_"+e.rowKey+l.id,model:e,rules:F(G),key:e.rowKey},{default:h((()=>[g(m,{prop:"enddate"},{default:h((()=>[g(U,{modelValue:e.enddate,"onUpdate:modelValue":l=>e.enddate=l,"value-format":"YYYY-MM-DD",onChange:a=>z(e,l)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:2},1024)])),_:2},1032,["model","rules"]))])),deleteDefault:h((({slotProps:{row:e}})=>[g(f,{onClick:l=>function(e){x.value.fitsTablePro.remove(e),c.value=x.value.fitsTablePro.getTableData().tableData}(e)},{default:h((()=>[M])),_:2},1032,["onClick"])])),_:1},8,["option"]),V("div",O," 表格数据： "+D(F(c)),1)],64)}}}),[["__scopeId","data-v-c5204399"]]),E={class:"dynamic-table"},G={class:"content"},$={class:"right"},z={class:"menu"},A=(e=>(q("data-v-7fcb825c"),e=e(),U(),e))((()=>V("div",{class:"menu-title"},"此页内容",-1))),J=["id","onClick"],L=c({name:"DynamicTable"}),Q=f(c({...L,setup(e){const l=m([]),a=p({num:0});let t=0;const o={callback:function(e){l.value=e},selectors:["h1","h2"],exceptSelector:"[un-nav]",listenScroll:!0};const u=e=>{if(null!==t)r(t);else if(null===t)for(let t=0;t<l.value.length;t++){let o=document.getElementById("menuItem"+t);l.value[t].pos.top<=e.scrollTop+l.value[0].pos.top&&o&&(a.num=t)}},r=e=>{for(let a=0;a<l.value.length;a++){let l=document.getElementById("menuItem"+a);e!==a&&l&&(l.className="defaultStyle")}setTimeout((()=>{t=null}),100)};return(e,d)=>{const s=v,n=j("outline");return w(),_("div",E,[g(s,{class:"left",onScroll:u,always:""},{default:h((()=>[x((w(),_("div",G,[g(S,{title:"动态表格",desc:"动态表格展示了表单＋表格的结合使用。\n                表格内部的渲染器主要是通过表格插槽实现的。"},{default:h((()=>[g(N)])),_:1})])),[[n,o]])])),_:1}),V("div",$,[V("div",z,[A,(w(!0),_(P,null,C(F(l),((e,l)=>(w(),_("div",{class:T([{active:F(a).num===l},"defaultStyle"]),key:l,id:"menuItem"+l,onClick:R((o=>function(e,l){t=l,a.num=l,e.scrollIntoView({block:"start",inline:"nearest"}),r(t)}(e.el,l)),["stop"])},D(e.title),11,J)))),128))])])])}}}),[["__scopeId","data-v-7fcb825c"]]);export{Q as default};
