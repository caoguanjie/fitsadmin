import{y as e,c as l,S as a,o as t,g as o,X as u,f as r,h as d,N as s,H as n,L as i,j as f,M as v,G as c,F as m,_ as p,u as b,an as y,ao as w,a9 as _,I as g,A as h,R as k}from"./vxetable.d7bee61f.js";import{h as V}from"./moment.9709ab41.js";import{d as D}from"./index.826bcf43.js";import{_ as K,f as j}from"./index.3f3cf4eb.js";import{u as F}from"./FitsTableProHook.f4c020da.js";import{F as P}from"./FitsCard.f03b9a36.js";import"./echarts.d8b3161e.js";const C=e=>(y("data-v-6d0666e0"),e=e(),w(),e),U=C((()=>f("i",{class:"vxe-icon-add"},null,-1))),q=C((()=>f("span",{class:"redStar"},"*",-1))),x=C((()=>f("i",{class:"vxe-icon-delete"},null,-1))),T={class:"dataBox"};var R=K(e({__name:"DynamicTable",setup(e){const y=l(),w=l([]),_=l({}),g=l(),h=l(),k=l(),{fitsTablePro:K}=F({keepSource:!0,columns:[{field:"add",title:"操作",width:80,slots:{default:"addDefault"}},{field:"project",title:"项目",slots:{default:"projectDefault",header:"requiredHeader"}},{field:"batch",title:"批次/迭代",slots:{default:"batchDefault",header:"requiredHeader"}},{field:"type",title:"工时类型",slots:{default:"typeDefault"}},{field:"task",title:"任务内容",slots:{default:"taskDefault",header:"requiredHeader"}},{field:"responsible",title:"责任人",slots:{default:"responsibleDefault",header:"requiredHeader"}},{field:"reviewer",title:"工时审核人",slots:{default:"reviewerDefault"}},{field:"startdate",title:"计划开始",slots:{default:"startdateDefault"}},{field:"enddate",title:"计划完成",slots:{default:"enddateDefault"}},{field:"delete",title:"操作",width:80,slots:{default:"deleteDefault"}}],data:[{project:"",batch:"",type:"",task:"",responsible:"",reviewer:"",startdate:"",enddate:""},{project:"",batch:"",type:"",task:"",responsible:"",reviewer:"",startdate:"",enddate:""},{project:"",batch:"",type:"",task:"",responsible:"",reviewer:"",startdate:"",enddate:""}],align:"center",toolbarConfig:{slots:{buttons:"buttons"}},rowConfig:{keyField:"rowKey",useKey:!0},columnConfig:{useKey:!0}},k),P=l([{value:"丰德开发框架项目"},{value:"2019年领床路径系统二期产品"},{value:"2019年领床路径系统一期产品"},{value:"开发组"},{value:"2022年特种机电设备检测"},{value:"健康档案系统"},{value:"2021年资产管理系统"},{value:"2023Vue升级"}]),C=(e,l)=>{l(e?P.value.filter((l=>-1!==l.value.toLowerCase().indexOf(e))):P.value)},R=l([{label:".net core开原框架研究",value:"0"},{label:"Fits Framework",value:"1"},{label:"PC后台管理网站",value:"2"},{label:"混合app-ionic5",value:"3"},{label:"辅助工具",value:"4"},{label:"新PC前端框架研发",value:"5"}]),I=l([{label:"项目管理",value:"0"},{label:"售前支持",value:"1"},{label:"需求分析",value:"2"},{label:"系统设计",value:"3"},{label:"功能开发",value:"4"}]),S=l([{label:"李小白",value:"0"},{label:"王辉",value:"1"},{label:"张冰冰",value:"2"},{label:"李萌萌",value:"3"},{label:"白静",value:"4"}]),Y=a({project:[{required:!0,message:"请选择项目",trigger:"change"}],task:[{required:!0,message:"请输入任务内容",trigger:"change"}],batch:[{required:!0,message:"请选择批次",trigger:"change"}],responsible:[{required:!0,message:"请选择责任人",trigger:"change"}],startdate:[{validator:O,type:"date",trigger:"change"}],enddate:[{validator:O,type:"date",trigger:"change"}]});function H(){k.value.fitsTablePro.insertAt({project:"",batch:"",type:"",task:"",responsible:"",reviewer:"",startdate:"",enddate:""},-1),w.value=k.value.fitsTablePro.getTableData().tableData}function M(e,l){g.value=e.rowKey;const a="dateFormRef_"+e.rowKey+l.id;if(h.value=a,void 0===_.value[e.rowKey]?_.value[e.rowKey]={[l.field]:e[l.field]}:_.value[e.rowKey][l.field]=e[l.field],_.value[e.rowKey]&&void 0!==_.value[e.rowKey].startdate&&void 0!==_.value[e.rowKey].enddate){const t=a.split("_"),o="startdate"===l.field?Number(t.slice(-1))+1:Number(t.slice(-1))-1,u=`dateFormRef_${e.rowKey}col_${o}`;y.value.refs[u].validate()}}function O(e,l,a,t,o){if(_.value[g.value]&&l)if(_.value[g.value]&&_.value[g.value].startdate&&_.value[g.value].enddate)if(V(_.value[g.value].startdate).isBefore(_.value[g.value].enddate))a();else{const l="startdate"===e.field?"不得大于结束时间":"不得小于开始时间";a(new Error(l))}else a();else a()}function B(){w.value=k.value.fitsTablePro.getTableData().tableData}function N(){let e=0,l=0,a=0,t=0;for(let o in y.value.refs)-1!==o.indexOf("requiredFormRef_")&&null!==y.value.refs[o]&&l++,-1!==o.indexOf("dateFormRef_")&&null!==y.value.refs[o]&&t++;for(let o in y.value.refs)-1!==o.indexOf("requiredFormRef_")&&null!==y.value.refs[o]&&y.value.refs[o].validate(((l,a)=>{l&&e++})),-1!==o.indexOf("dateFormRef_")&&null!==y.value.refs[o]&&y.value.refs[o].validate(((o,u)=>{o&&(a++,e===l&&a===t&&j({message:"保存成功",type:"success"}))}))}return t((()=>{y.value=o()})),(e,l)=>{const a=u("el-button"),t=u("el-autocomplete"),o=u("el-form-item"),y=u("el-form"),_=u("el-option"),g=u("el-select"),h=u("el-input"),V=u("el-date-picker");return r(),d(m,null,[s(b(D),{option:b(K),ref_key:"xGrid",ref:k},{buttons:n((()=>[s(a,{onClick:B},{default:n((()=>[i(" 获取数据 ")])),_:1}),s(a,{onClick:N},{default:n((()=>[i(" 保存 ")])),_:1})])),addDefault:n((()=>[s(a,{onClick:H},{default:n((()=>[U])),_:1})])),requiredHeader:n((({slotProps:{column:e}})=>[q,f("span",null,v(e.title),1)])),projectDefault:n((({slotProps:{row:e,column:l}})=>[(r(),c(y,{ref:"requiredFormRef_"+e.rowKey+l.id,model:e,rules:Y,key:e.rowKey},{default:n((()=>[s(o,{prop:"project"},{default:n((()=>[s(t,{modelValue:e.project,"onUpdate:modelValue":l=>e.project=l,placeholder:"请输入","fetch-suggestions":C,clearable:""},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1032,["model","rules"]))])),batchDefault:n((({slotProps:{row:e,column:l}})=>[(r(),c(y,{ref:"requiredFormRef_"+e.rowKey+l.id,model:e,rules:Y,key:e.rowKey},{default:n((()=>[s(o,{prop:"batch"},{default:n((()=>[s(g,{modelValue:e.batch,"onUpdate:modelValue":l=>e.batch=l},{default:n((()=>[(r(!0),d(m,null,p(R.value,(e=>(r(),c(_,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1032,["model","rules"]))])),typeDefault:n((({slotProps:{row:e}})=>[s(o,null,{default:n((()=>[s(g,{modelValue:e.type,"onUpdate:modelValue":l=>e.type=l},{default:n((()=>[(r(!0),d(m,null,p(I.value,(e=>(r(),c(_,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),taskDefault:n((({slotProps:{row:e,column:l}})=>[(r(),c(y,{ref:"requiredFormRef_"+e.rowKey+l.id,model:e,rules:Y,key:e.rowKey},{default:n((()=>[s(o,{prop:"task"},{default:n((()=>[s(h,{modelValue:e.task,"onUpdate:modelValue":l=>e.task=l},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1032,["model","rules"]))])),responsibleDefault:n((({slotProps:{row:e,column:l}})=>[(r(),c(y,{ref:"requiredFormRef_"+e.rowKey+l.id,model:e,rules:Y,key:e.rowKey},{default:n((()=>[s(o,{prop:"responsible"},{default:n((()=>[s(g,{modelValue:e.responsible,"onUpdate:modelValue":l=>e.responsible=l},{default:n((()=>[(r(!0),d(m,null,p(S.value,(e=>(r(),c(_,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1032,["model","rules"]))])),reviewerDefault:n((({slotProps:{row:e}})=>[s(o,null,{default:n((()=>[s(g,{modelValue:e.reviewer,"onUpdate:modelValue":l=>e.reviewer=l},{default:n((()=>[(r(!0),d(m,null,p(S.value,(e=>(r(),c(_,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),startdateDefault:n((({slotProps:{row:e,column:l}})=>[(r(),c(y,{ref:"dateFormRef_"+e.rowKey+l.id,model:e,rules:Y,key:e.rowKey},{default:n((()=>[s(o,{prop:"startdate"},{default:n((()=>[s(V,{modelValue:e.startdate,"onUpdate:modelValue":l=>e.startdate=l,"value-format":"YYYY-MM-DD",onChange:a=>M(e,l)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:2},1024)])),_:2},1032,["model","rules"]))])),enddateDefault:n((({slotProps:{row:e,column:l}})=>[(r(),c(y,{ref:"dateFormRef_"+e.rowKey+l.id,model:e,rules:Y,key:e.rowKey},{default:n((()=>[s(o,{prop:"enddate"},{default:n((()=>[s(V,{modelValue:e.enddate,"onUpdate:modelValue":l=>e.enddate=l,"value-format":"YYYY-MM-DD",onChange:a=>M(e,l)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:2},1024)])),_:2},1032,["model","rules"]))])),deleteDefault:n((({slotProps:{row:e}})=>[s(a,{onClick:l=>function(e){k.value.fitsTablePro.remove(e),w.value=k.value.fitsTablePro.getTableData().tableData}(e)},{default:n((()=>[x])),_:2},1032,["onClick"])])),_:1},8,["option"]),f("div",T," 表格数据： "+v(w.value),1)],64)}}}),[["__scopeId","data-v-6d0666e0"]]);const I={class:"dynamic-table"},S={class:"content"},Y={class:"right"},H={class:"menu"},M=(e=>(y("data-v-406c096a"),e=e(),w(),e))((()=>f("div",{class:"menu-title"},"此页内容",-1))),O=["id","onClick"],B=e({name:"DynamicTable"});var N=K(e({...B,setup(e){const t=l([]),o=a({num:0});let i=0;const c={callback:function(e){t.value=e},selectors:["h1","h2"],exceptSelector:"[un-nav]",listenScroll:!0};const b=e=>{if(null!==i)y(i);else if(null===i)for(let l=0;l<t.value.length;l++){let a=document.getElementById("menuItem"+l);t.value[l].pos.top<=e.scrollTop+t.value[0].pos.top&&a&&(o.num=l)}},y=e=>{for(let l=0;l<t.value.length;l++){let a=document.getElementById("menuItem"+l);e!==l&&a&&(a.className="defaultStyle")}setTimeout((()=>{i=null}),100)};return(e,l)=>{const a=u("el-scrollbar"),w=_("outline");return r(),d("div",I,[s(a,{class:"left",onScroll:b,always:""},{default:n((()=>[g((r(),d("div",S,[s(P,{title:"动态表格",desc:"动态表格展示了表单＋表格的结合使用。\n                表格内部的渲染器主要是通过表格插槽实现的。"},{default:n((()=>[s(R)])),_:1})])),[[w,c]])])),_:1}),f("div",Y,[f("div",H,[M,(r(!0),d(m,null,p(t.value,((e,l)=>(r(),d("div",{class:h([{active:o.num===l},"defaultStyle"]),key:l,id:"menuItem"+l,onClick:k((a=>function(e,l){i=l,o.num=l,e.scrollIntoView({block:"start",inline:"nearest"}),y(i)}(e.el,l)),["stop"])},v(e.title),11,O)))),128))])])])}}}),[["__scopeId","data-v-406c096a"]]);export{N as default};
